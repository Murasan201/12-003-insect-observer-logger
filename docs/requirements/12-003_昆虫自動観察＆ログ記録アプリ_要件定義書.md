### 文書番号: 12-003

## 1. アプリ名
- アプリ名: 昆虫自動観察＆ログ記録アプリ

## 2. 概要
Raspberry Pi 5に取り付けた赤外線対応カメラ（Camera Module V3 NoIR）とIR LEDリングライト（850nm FRS5CS）を用いて、夜間も含めてカブトムシの動きを自動で検出・記録し、一日の活動量（検出回数、移動距離）を算出・可視化するPythonアプリケーションです。検出モジュールと活動量算出モジュールを別ファイルで実装し、統合モジュールから呼び出す設計とします。

## 3. 目的
- 夜間観察対応の赤外線カメラ制御および照明制御技術を習得
- YOLOv8ベースの昆虫検出モデル（beetle-detection-yolov8）の応用方法を学ぶ
- 検出データから移動量・活動量を算出し、可視化するワークフローを習得

## 4. 対象利用者
- プログラミング初心者
- Raspberry Pi入門者
- 生物観察およびIoTアプリ開発に興味がある教育者・研究者

## 5. システム構成
| コンポーネント                                    | 役割                                                 |
|-------------------------------------------------|------------------------------------------------------|
| Raspberry Pi 5                                  | スクリプト実行、モジュール連携                       |
| Raspberry Pi カメラモジュール V3 NoIR           | 赤外線カメラキャプチャ                                |
| IR LEDリングライト (850nm FRS5CS)               | 夜間照明                                              |
| GitHub リポジトリ (insect-detection-training)   | 検出モデル訓練コードベース                            |
| Hugging Face モデルリポジトリ                   | 学習済み昆虫検出モデル取得                            |

## 6. ハードウェア要件
- Raspberry Pi 5本体
- microSDカード（Raspberry Pi OSインストール済み）
- Raspberry Pi カメラモジュール V3 NoIR（SKU:8701）
- IR LEDリングライト 850nm FRS5CS
- 電源（公式5Vアダプタ）
- ジャンパーワイヤ、固定具

## 7. ソフトウェア要件
- OS：Raspberry Pi OS（最新推奨）
- 言語：Python 3.9以上
- ベースリポジトリ: https://github.com/Murasan201/insect-detection-training
- 学習済みモデル: https://huggingface.co/[your-username]/beetle-detection-yolov8
- ライブラリ：
  - ultralytics（YOLOv8推論）
  - opencv-python（映像入力・描画）
  - numpy, pandas（データ処理）
  - matplotlib（グラフ生成）
  - python-dotenv（環境変数管理）
- その他の依存は設計者が調査・選定すること

## 8. 機能要件
1. **検出モジュール**（insect_detector.py）
   - カメラからフレーム取得
   - YOLOv8モデルでカブトムシを検出し、バウンディングボックスと座標を返す
2. **活動量算出モジュール**（activity_calculator.py）
   - 連続検出結果から個体の移動距離を計算
   - 検出回数、総移動距離を集計
3. **統合モジュール**（main.py）
   - 定期的（例：60秒おき）に検出モジュールを呼び出し、結果をログ保存
   - 一日の終わりに活動量算出モジュールを実行し、CSVとグラフを生成
4. **グラフ生成**
   - matplotlibで時間対活動量（移動距離・検出回数）をプロット
   - 生成したグラフ画像をPNGで保存
5. **ログ記録**
   - timestamp, x, y座標, 検出フラグ をCSVに追記

## 9. 非機能要件
- **可読性**: PEP8準拠、ドキュメントコメントを充実
- **モジュール化**: 検出・集計機能を分離し、再利用性を確保
- **単一責任**: 各ファイルは単一機能のみを担当
- **効率性**: フレーム処理時間は1秒未満を目標

## 10. テスト要件
- **検出テスト**: 動画サンプルでカブトムシ検出精度を検証
- **移動距離テスト**: 既知の動線で算出距離の正確性確認
- **ログ整合性テスト**: CSVフォーマットとデータ一貫性確認
- **グラフ生成テスト**: プロット結果が期待どおりの形式で出力される

## 11. 受け入れ基準
1. 検出モジュールがカブトムシを安定して検出できる
2. 活動量算出モジュールが正確に移動距離と検出回数を集計する
3. CSVおよびグラフが指定フォルダに生成される
4. 24時間連続稼働後もメモリリークなく安定動作する

---
以上の要件をもとに、昆虫自動観察＆ログ記録アプリのプロトタイプを開発してください。
